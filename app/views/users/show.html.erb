<div class="row">
  <div class="col">
    <header class="page-header">
      <h1 class="title">
        <%= @user.name %>&nbsp(<%= @user.role.capitalize %>)
      </h1>
      <%= render 'edit-box', target: @user %>
    </header>
  </div>
</div>

<div class="row">
  <div class="col-3">
    <div class="box">
      <div class="box-header">
        Profile
      </div>
      <div class="box-content">
        <%= image_tag(@user.avatar, class: 'avatar') %>
        <p>
          <strong>Username:</strong>
          <%= @user.login %>
        </p>

        <p>
          <strong>Email:</strong>
          <%= mail_to @user.email %>
        </p>

        <p>
          <strong>Locale:</strong>
          <%= t('language', locale: @user.locale) %>
        </p>

        <p>
          <strong>Default fee:</strong>
          <%= fee(@user.default_fee) %>
        </p>

        <p>
          <strong>Cases owned:</strong>
          <%= link_to @user.projects.count, projects_path(owner: @user.id) %> (<%= link_to @user.projects.where(status: :active).count, projects_path(owner: @user.id, status: :active) %> of which are active)
        </p>
      </div>
    </div>
    <div class="box">
      <div class="box-header">
        Assigned deadlines
      </div>
      <div class="box-content">
        deadlines
      </div>
    </div>
  </div>
  <div class="col-5">
    <ul class="timeline">
      <% Activity.where(user: @user).order(date: :desc).limit(5).includes(:project).group_by(&:date).sort.reverse.each do |date| %>
      <li class="timeline-date">
        <header class="timeline-header">
          <span class="timeline-icon"><%= icon_tag('git-commit') %></span>
          Activity logged on <%= date.first.strftime("%d.%m.%Y") %>
        </header>
        <ul class="box">
          <% date.last.each do |activity| %>
          <li class="box-row">
            <div class="card">
              <div class="card-header">
                <%= link_to activity.label, activity.project %>
                <span class="push tag"><%= activity.category %></span>
              </div>
              <div class="card-content">
                <span class="icon-text">
                  <%= icon_tag('repo') %>
                  <%= "#{ activity.project.label } (#{ strip_tags(main_parties(activity.project)) })" %>
                </span>
              </div>
            </div>
          </li>
          <% end %>
        </ul>
      </li>
      <% end %>
    </ul>
  </div>
</div>
